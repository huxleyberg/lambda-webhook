Transform: AWS::Serverless-2016-10-31
Resources:
  MyApiGateway:
    Type: AWS::Serverless::Api
    Properties:
      StageName: dev
      DefinitionBody:
        Fn::Transform:
          Name: AWS::Include
          Parameters:
            Location: ../../open-api.yaml
      MethodSettings:
      - HttpMethod: '*'
        LoggingLevel: DEBUG
        ResourcePath: /*
        MetricsEnabled: true
        DataTraceEnabled: true
  SupportUserCreatedFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: SupportUserCreatedFunction
      Handler: main
      Runtime: go1.x
      Events:
        SupportUserCreated:
          Type: Api
          Properties:
            RestApiId:
              Ref: MyApiGateway
            Path: /zendesk/webhooks/support-user-created
            Method: POST
    Metadata:
      SamResourceId: SupportUserCreatedFunction
Outputs:
  ApiEndpoint:
    Description: Endpoint URL of the API
    Value:
      Fn::Sub: https://${MyApiGateway}.execute-api.${AWS::Region}.amazonaws.com/dev/
    Export:
      Name: MyApiEndpoint
