Transform: AWS::Serverless-2016-10-31
Resources:
  ApiGateway:
    Type: AWS::Serverless::Api
    Properties:
      StageName: dev
      DefinitionBody:
        Fn::Transform:
          Name: AWS::Include
          Parameters:
            Location: ../../open-api.yaml
  SupportUserCreatedFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: SupportUserCreatedFunction
      Handler: main
      Runtime: go1.x
      Events:
        SupportUserCreated:
          Type: Api
          Properties:
            RestApiId:
              Ref: ApiGateway
            Path: /zendesk/webhooks/support-user-created
            Method: POST
    Metadata:
      SamResourceId: SupportUserCreatedFunction
  MyDeployment:
    Type: AWS::ApiGateway::Deployment
    DependsOn: ApiGateway
    Properties:
      RestApiId:
        Ref: ApiGateway
      StageName: dev
Outputs:
  ApiEndpoint:
    Description: Endpoint URL of the API
    Value:
      Fn::Sub: https://${ApiGateway}.execute-api.${AWS::Region}.amazonaws.com/dev/zendesk/webhooks/support-user-created
    Export:
      Name: MyApiEndpoint
